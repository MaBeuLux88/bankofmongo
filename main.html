<!DOCTYPE html>
<html lang="en">
<title>Bank of Mongo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
<script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.0.13/stitch.js"></script>
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<link rel="stylesheet" type="text/css" href="style.css">
<script>
      client = stitch.Stitch.initializeDefaultAppClient("mongobank-tpdvx");
      const db = client.getServiceClient(stitch.RemoteMongoClient.factory, 'mongodb-atlas').db('MongoBank');
      if (this.client.auth.hasRedirectResult()) {
      this.client.auth.handleRedirectResult().then(user => {
        console.log('Display ledger!');
        displayComments();
      })
        } else { console.log('not authenticated'); }
    
      function displayComments() {
          console.log('-->' + client.auth.user.id);
        db.collection("ledger")
          .find({}, { limit: 1000 })
          .asArray()
         // .then(docs => docs.map(doc => `<div>${doc.comment}</div>`))
          .then(ledger => {
            for (var x in ledger) {
                console.log(JSON.parse(x));
                document.getElementById("ledger").innerHTML += x['descrption'];
                }
       //       document.getElementById("ledger").innerHTML = '<b>${ledger.description}</b>'
            
            })
      }
     
</script>
</head>
<body>
    <script>
     function Deposit()
      {
          console.log(client);
           alert('newdate');
          //Stitch.defaultAppClient.callFunction(
          client.callFunction("Deposit",{
            "description" : "testing",
            "action" : "deposit",
            "value" : 100,
            "ts" : new Date()
        });
        alert('Done');
      }
    </script>
    <nav class="navbar navbar-light" style="background-color: #DCDCDC;"> 
        <div class="container-fluid">
            <div class="navbar-header">
                <a href="#"><img alt="Bank of Mongo" src="title.png"></a>
            </div>
            <div class="navbar-header navbar-right">
                <button type="button" class="btn btn-default navbar-btn"><span class="glyphicon glyphicon-warning-sign"></span>&nbsp;Alerts</button>    
                <a href="/logout" class="btn btn-default navbar-btn"><span class="glyphicon glyphicon-off"></span>&nbsp;Log out</a>
            </div>
        </div>
    </nav>

<div class="container">
        <h3>Ledger</h3>
        <div class="panel panel-default">
          <div class="panel-body">
              <div class="row" style="background:#dddddd;padding:10px;">
                <div class="col-sm-2">Date</div>
                <div class="col-sm-4">Description</div>
                <div class="col-sm-2">Deposit</div>
                <div class="col-sm-2">Withdrawl</div>
                <div class="col-sm-2">Balance</div>
              </div>
<div id="ledger"></div>
            </div>
        </div>
</div>

<div class="footer" style="padding:3px">
<div class="row">
<div class="col-sm-2">
<button type="button" class="btn btn-default" onclick="Deposit()"><span class="glyphicon glyphicon-plus"></span>&nbsp;Deposit</button>
</div>

<div class="col-sm-2">
<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-minus"></span>&nbsp;Withdrawl</button>
</div>
<div class="col-sm-6">&nbsp;</div>
<div class="col-sm-2">
<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-repeat"></span>&nbsp;Reset Demo</button>
</div>


</body>
</html>