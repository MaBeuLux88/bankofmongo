<!DOCTYPE html>
<html lang="en">
<title>Bank of Mongo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
  <!-- Stitch JavaScript SDK -->
  <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.0.8/stitch.js"></script>

  <!-- Bootstrap 4 css -->s
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script>
      function handleLogin()
  {
      console.log('here');

      const {
  Stitch,
  RemoteMongoClient,
  GoogleAuthClient,
} = stitch;
const client = stitch.Stitch.initializeDefaultAppClient("mongobank-tpdvx");
console.log(client);
const db = client.getServiceClient(stitch.RemoteMongoClient.factory, 'mongodb-atlas').db('MongoBank');
//console.log(db);
const credential = new stitch.GoogleRedirectCredential("http://bankofmongo.com");
console.log('-->' + JSON.stringify(credential));
//stitch.Stitch.defaultAppClient.auth.loginWithRedirect(credential);
client.auth.loginWithRedirect(credential).then(user => 
    db.collection('ledger').updateOne({owner_id: client.auth.user.id}, {$set:{number:42}}, {upsert:true})
  ).then(() => 
    db.collection('ledger').find({owner_id: client.auth.user.id}, { limit: 100}).asArray()
  ).then(docs => {
      console.log("Found docs", docs)
      console.log("[MongoDB Stitch] Connected to Stitch")
  }).catch(err => {
    console.error(err)
  });



   /* client.authenticate("google").then((id) =>
      displayEmployees()).catch(err => {
      console.error(err)
    });*/
  }
  </script>
</head>

<body>
  <h1 align="center" class="page-title">Bank of Mongo</h1>
  <h3 align="center" id="auth-type-identifier">Log in</h3>
  <div class="login-container">

    <div id="login-form"></div>
      <button type="submit" id="login-button" class="btn btn-primary" onclick="handleLogin()">Log In</button>
    </div>

  </div>


  </div>
    
</body>

</html>
