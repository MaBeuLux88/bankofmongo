<!DOCTYPE html>
<html lang="en">
<title>Bank of Mongo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
  <!-- Stitch JavaScript SDK -->
  <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.0.13/stitch.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script>

    const {
    Stitch,
    RemoteMongoClient,
    GoogleRedirectCredential,
    } = stitch;
    console.log('********');

    client = stitch.Stitch.initializeDefaultAppClient("mongobank-tpdvx");
    const credential = new stitch.GoogleRedirectCredential();
    const db = client.getServiceClient(stitch.RemoteMongoClient.factory, 'mongodb-atlas').db('MongoBank');
    if (this.client.auth.hasRedirectResult()) {
      this.client.auth.handleRedirectResult().then(user => {
        console.log(user);
      })
    }
    function handleLogin()
    {
  //stitch.Stitch.defaultAppClient.auth.loginWithRedirect(credential);
client.auth.loginWithRedirect(credential).then(user => 
    db.collection('ledger').updateOne({owner_id: client.auth.user.id}, {$set:{number:42}}, {upsert:true})
  ).then(() => 
    db.collection('ledger').find({owner_id: client.auth.user.id}, { limit: 100}).asArray()
  ).then(docs => {
      console.log("Found docs", docs)
      console.log("[MongoDB Stitch] Connected to Stitch")
  }).catch(err => {
    console.error(err)
  });

 if (this.client.auth.hasRedirectResult()) {
      this.client.auth.handleRedirectResult().then(user => {
        console.log('Yea WE ARE HERE');
      })
    }

  }
  </script>
</head>

<body>
  <h1 align="center" class="page-title">Bank of Mongo</h1>
  <h3 align="center" id="auth-type-identifier">Log in</h3>
  <div class="login-container">

    <div id="login-form"></div>
      <button type="submit" id="login-button" class="btn btn-primary" onclick="handleLogin()">Log In</button>
    </div>

  </div>


  </div>
    
</body>

</html>
